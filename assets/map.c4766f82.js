import Z from"./LocationFound.ede4da9f.js";import ee from"./Logo.f0a1ad5e.js";import te from"./Radar.738c9111.js";import oe from"./CompassCardinalPoints.b8c32871.js";import ae from"./Compass.bcfca0fd.js";import ne from"./Button.31676608.js";import se from"./Intersect.7310d918.js";import le from"./Search.a5507dee.js";import ce from"./Menu.27b20210.js";import re from"./NavigationBar.986c23a5.js";import ie from"./Menu.8508005f.js";import{l as ue,bP as me,c0 as de,u as _e,x as fe,r as n,j as pe,g as ve,bF as he,c as _,b as a,w as u,T as S,a as f,p as e,m as h,F as ye,bW as ge,o as r,v as we,n as Ce,i as q,bH as xe,bI as ke,bQ as M,c2 as be}from"./entry.ccd82dae.js";import{q as Re}from"./query.c4a1f15e.js";import{u as Be}from"./map.577e8fb0.js";import{d as Ie}from"./timer.1612f152.js";import{u as Le}from"./locations.04106c76.js";import{g as Se}from"./index.4db78ffb.js";import{P as Me,L as $}from"./permission.53916802.js";import{a as $e}from"./index.b485ba4b.js";import"./Diamond.7df37d6a.js";import"./BlurredCircle.6329082e.js";import"./tw-merge.1166cefb.js";import"./nuxt-link.e90d49c1.js";import"./SectionHeading.51a8db1f.js";import"./Cross.2d0a83c6.js";import"./utils.78aafd7a.js";import"./preview.60508192.js";const V=y=>(xe("data-v-23e0f4a3"),y=y(),ke(),y),Fe={key:0},Ne={class:"relative"},Ee={key:0,class:"fixed h-full w-full top-0 left-0 radar-background"},Pe=V(()=>f("div",{class:"fixed w-full top-0 h-[20vh] bg-gradient-to-b from-sky-900 to-70%"},null,-1)),Te={key:0,class:"fixed left-0 top-0 translate-y-[-180%] container text-center"},qe=V(()=>f("div",{class:"text-md text-yellow-200"}," ¡Vaya! Parece que aquí no hay nada ",-1)),Ve=[qe],je={key:0},Ae={__name:"map",async setup(y){let g,F;const N=me(),{data:k}=([g,F]=de(()=>ge("locations",()=>Re("location").find(),{transform:t=>Object.keys(t).map(d=>t[d])})),g=await g,F(),g),l=Be(),j=_e(),E=fe();n(null);const w=n(null),m=n(null),b=n(null),C=n(null),R=n(null),c=n(),x=n(!1),o=n(),p=n(),P=n(),A=n(0),B=n(!1),{width:I,height:De}=$e(),T=be(),D=()=>{const t=C.value.getBoundingClientRect(),d=t.top+t.height/2;t.left+t.width/2;const i=w.value.getBoundingClientRect();w.value.style.top=`${d-i.height/2}px`},z=t=>{B.value||(B.value=!0,l.value.toggleCenitalView({onComplete:()=>{B.value=!1}}))},U=async()=>{const t=Se.timeline();P.value=await Me.requestLocation(),P.value?(c.value=!0,t.add("start").to(b.value,{x:-I.value},"start").to(R.value,{x:I.value},"start"),T.trackEvent({event:"search_location",category:"Locations",action:"Search"}),Promise.all([$.getCurrentLocation(),Ie(4e3)]).then(([d])=>{let i;for(let s=0;s<k.value.length;s++){const v=$.calculateDistanceBetweenCoordinates(d,k.value[s].place.coordinate);v<$.NEARBY_DISTANCE_IN_KM&&(!i||v<i)&&(i=v,o.value=k.value[s])}if(c.value=!1,p.value=!0,o.value?(m.value.show({expanded:!1}),t.to(C.value,{y:I.value*.5})):t.add("start").to(b.value,{x:0},"start").to(R.value,{x:0},"start"),o.value){const s=Le();s.value.includes(o.value._id)||(s.value.push(o.value._id),T.trackEvent({event:"location_found",category:"Locations",action:"Found",label:o.value.title})),setTimeout(()=>{E.push({path:`${o.value._path}/model`})},5e3)}else setTimeout(()=>{p.value=!1},2e3)})):E.push({path:"/permissions"})},W=t=>{l.value.hide(),m.value.hide(),x.value=!0},H=t=>{setTimeout(()=>{l.value.show()},300),m.value.show({expanded:!0,onComplete:()=>{x.value=!1}})};return pe(()=>{C.value&&w.value&&D(),x.value||c.value||p.value?N.value=M.sky[900]:N.value=j.value?M.teal[700]:M.teal[500]}),ve(()=>{m.value&&m.value.show({expanded:!0}),l.value&&(l.value.show(),l.value.showLocations())}),he(()=>{l.value&&l.value.hideLocations()}),(t,d)=>{const i=Z,s=ee,v=te,K=oe,O=ae,L=ne,Q=se,X=le,Y=ce,G=re,J=ie;return r(),_(ye,null,[a(S,{name:"fade",appear:""},{default:u(()=>[e(o)?(r(),_("div",Fe,[a(i,{location:e(o)},null,8,["location"])])):h("",!0)]),_:1}),f("div",Ne,[a(s,{"enable-night-mode-change":""}),a(S,{name:"fade",appear:""},{default:u(()=>[e(c)||e(p)&&!e(o)?(r(),_("div",Ee)):h("",!0)]),_:1}),e(c)?(r(),_("div",{key:0,ref_key:"radarRef",ref:w,class:"fixed top-0 left-0 w-screen h-screen"},[a(v),Pe],512)):h("",!0),a(G,{ref_key:"navRef",ref:m,"initial-state":"hide",centered:""},{default:u(()=>[f("div",{ref_key:"compassButtonRef",ref:b},[a(L,{onClick:z,class:"bg-yellow-200 h-16 w-16 relative flex justify-center items-center",format:"circle",shadowed:""},{default:u(()=>[a(K,{class:"absolute w-full h-full"}),a(O,{class:"h-8 w-8",style:we({transform:`rotate(${e(A)}deg)`})},null,8,["style"])]),_:1})],512),f("div",{ref_key:"searchButtonRef",ref:C,class:"relative"},[a(S,{name:"fade",appear:""},{default:u(()=>[e(p)&&!e(o)?(r(),_("div",Te,Ve)):h("",!0)]),_:1}),a(L,{onClick:U,class:Ce(["bg-cyan-100 p-11",{"border-[3px] border-yellow-100 p-9 bg-gradient-to-b from-sky-900 bg-transparent":e(c)||e(o),"bg-cyan-100":!e(c)&&!e(o)}]),format:"circle",shadowed:""},{default:u(()=>[e(c)||e(o)?(r(),q(Q,{key:0,class:"h-12 w-12"})):(r(),q(X,{key:1,class:"h-8 w-8"}))]),_:1},8,["class"])],512),f("div",{ref_key:"menuButtonRef",ref:R},[a(L,{onClick:W,class:"bg-yellow-200 h-16 w-16 flex justify-center items-center",format:"circle",shadowed:""},{default:u(()=>[a(Y,{class:"h-8 w-8"})]),_:1})],512)]),_:1},512)]),e(x)?(r(),_("div",je,[a(J,{onClose:H})])):h("",!0)],64)}}},pt=ue(Ae,[["__scopeId","data-v-23e0f4a3"]]);export{pt as default};
